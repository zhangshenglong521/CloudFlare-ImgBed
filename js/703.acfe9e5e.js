"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[703],{4318:function(){},1703:function(e,t,a){a.r(t),a.d(t,{default:function(){return T}});var n=a(9114),o=(a(5331),a(694),a(7815)),i=(a(5534),a(2565)),d=(a(8736),a(213),a(5970),a(7009)),l=(a(8450),a(8785),a(4880)),s=(a(7128),a(1450)),r=a(6768),h=a(4232);const u={class:"container"},c={class:"header-content"},p={class:"header-action"},m={class:"main-container"},g={style:{margin:"8px"}},f=["src"],b={class:"pagination-container"};function k(e,t,a,k,w,C){const y=(0,r.g2)("font-awesome-icon"),L=s.R7,T=l.bZ,v=i.o8,x=d.Zq,z=i.Up,F=o.aQ,S=n.L;return(0,r.uX)(),(0,r.CE)("div",u,[(0,r.bF)(T,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",c,[t[0]||(t[0]=(0,r.Lk)("span",{class:"title"},"用户管理",-1)),(0,r.Lk)("div",p,[(0,r.bF)(L,{disabled:C.disableTooltip,content:"返回主管理页",placement:"bottom"},{default:(0,r.k6)((()=>[(0,r.bF)(y,{icon:"home",class:"header-icon",onClick:C.handleGoHome},null,8,["onClick"])])),_:1},8,["disabled"]),(0,r.bF)(L,{disabled:C.disableTooltip,content:"返回上传页",placement:"bottom"},{default:(0,r.k6)((()=>[(0,r.bF)(y,{icon:"upload",class:"header-icon",onClick:C.handleGoUpload},null,8,["onClick"])])),_:1},8,["disabled"]),(0,r.bF)(L,{disabled:C.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,r.k6)((()=>[(0,r.bF)(y,{icon:"sign-out-alt",class:"header-icon",onClick:C.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,r.Lk)("div",m,[(0,r.bF)(z,{data:w.dealedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed",onExpandChange:C.expandRow},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"expand"},{default:(0,r.k6)((e=>[(0,r.Lk)("div",g,[t[1]||(t[1]=(0,r.Lk)("h3",{style:{"text-align":"center"}},"上传文件列表",-1)),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(z,{data:e.row.data,style:{width:"100%"},"default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{prop:"metadata.FileName",label:"文件名"}),(0,r.bF)(v,{prop:"name",label:"文件预览"},{default:(0,r.k6)((({row:e})=>[e.metadata?.FileType?.includes("image")?((0,r.uX)(),(0,r.Wv)(x,{key:0,src:"/file/"+e.name,fit:"cover",lazy:"",style:{width:"100px",height:"100px"}},null,8,["src"])):((0,r.uX)(),(0,r.CE)("video",{key:1,src:"/file/"+e.name,controls:"",style:{width:"100px",height:"100px"}},null,8,f))])),_:1}),(0,r.bF)(v,{formatter:C.formatTimeStamp,label:"上传时间",prop:"metadata.TimeStamp",sortable:"","sort-method":C.sortByTimestamp},{default:(0,r.k6)((({row:e})=>[(0,r.eW)((0,h.v_)(C.formatTimeStamp(e.metadata.TimeStamp)),1)])),_:1},8,["formatter","sort-method"])])),_:2},1032,["data"])),[[S,w.loading]]),(0,r.Lk)("div",b,[(0,r.bF)(F,{background:"",layout:"total, sizes, prev, pager, next","page-sizes":[15,100,300,500,1e3,5e3,1e4],total:e.row.total,"page-size":e.row.pageSize,onSizeChange:t=>C.handlePageSizeChange(t,e.row),disabled:e.row.disabledPage,onCurrentChange:t=>C.handlePageChange(t,e.row),"current-page":e.row.page},null,8,["total","page-size","onSizeChange","disabled","onCurrentChange","current-page"])])])])),_:1}),(0,r.bF)(v,{prop:"ip",label:"IP地址"}),(0,r.bF)(v,{prop:"count",label:"上传次数",sortable:""})])),_:1},8,["data","onExpandChange"])])])}a(4114),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);var w=a(782),C={name:"CustomerConfig",data(){return{loading:!1,tableData:[],dealedData:[]}},computed:{...(0,w.L8)(["credentials"]),disableTooltip(){return window.innerWidth<768}},methods:{handlePageChange(e,t){t.page=e,this.getList(t)},handlePageSizeChange(e,t){t.pageSize=e,this.getList(t)},getList(e){e.expand||this.fetchWithAuth("/api/manage/list?ip="+e.UploadIP,{method:"GET"}).then((e=>e.json())).then((t=>{e.data=this.dealByIP(t.data.records),e.expand=!0,this.loading=!1})).catch((e=>{this.loading=!1,"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")}))},expandRow(e,t){this.loading=!0,this.getList(e)},async fetchWithAuth(e,t={}){this.credentials&&(t.headers={...t.headers,Authorization:`Basic ${this.credentials}`},t.credentials="include");const a=await fetch(e,t);if(401===a.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return a},dealByIP(e){let t=[],a=new Set;return e.forEach((e=>{e?.UploadIP&&a.add(e.UploadIP)})),a.forEach((a=>{let n=e.filter((e=>e?.UploadIP===a)),o=e.count;t.push({ip:a,count:o,total:o,page:1,pageSize:15,disabledPage:!1,data:n})})),t},handleGoUpload(){this.$router.push("/")},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},handleGoHome(){this.$router.push("/dashboard")},formatTimeStamp(e){return new Date(e).toLocaleString()},sortByTimestamp(e,t){return new Date(e.metadata.TimeStamp)-new Date(t.metadata.TimeStamp)}},mounted(){this.fetchWithAuth("/api/manage/check",{method:"GET"}).then((e=>e.text())).then((e=>{if("true"==e)return this.showLogoutButton=!0,this.fetchWithAuth("https://studyjava.cn/api/cloudflare/files",{method:"GET"});if("Not using basic auth."==e)return this.fetchWithAuth("https://studyjava.cn/api/cloudflare/files",{method:"GET"});throw new Error("Unauthorized")})).then((e=>e.json())).then((e=>{this.tableData=[],this.dealedData=this.dealByIP(e.data)})).catch((e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")}))}},y=a(1241);const L=(0,y.A)(C,[["render",k],["__scopeId","data-v-686fa872"]]);var T=L},8736:function(e,t,a){a(5331)},7128:function(e,t,a){a(5331),a(4318)},8450:function(e,t,a){a(5331)},694:function(e,t,a){a(5331)},5534:function(e,t,a){a(5331),a(8785),a(5970),a(9104)},9104:function(e,t,a){a(5331)},5970:function(e,t,a){a(5331)},8785:function(e,t,a){a(5331)},213:function(e,t,a){a(5331),a(9104)}}]);
//# sourceMappingURL=703.acfe9e5e.js.map