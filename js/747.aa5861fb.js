"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[747],{4318:function(){},747:function(e,a,t){t.r(a),t.d(a,{default:function(){return L}});var n=t(9114),i=(t(5331),t(694),t(7815)),o=(t(5534),t(2565)),s=(t(8736),t(213),t(5970),t(7009)),l=(t(8450),t(8785),t(4880)),d=(t(7128),t(1450)),r=t(6768),h=t(4232);const p={class:"container"},u={class:"header-content"},c={class:"header-action"},g={class:"main-container"},m={style:{margin:"8px"}},b=["src"],f={class:"pagination-container"},w={class:"main-container pagination-container"};function k(e,a,t,k,C,y){const z=(0,r.g2)("font-awesome-icon"),x=d.R7,L=l.bZ,S=o.o8,v=s.Zq,F=o.Up,P=i.aQ,T=n.L;return(0,r.uX)(),(0,r.CE)("div",p,[(0,r.bF)(L,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",u,[a[0]||(a[0]=(0,r.Lk)("span",{class:"title"},"用户管理",-1)),(0,r.Lk)("div",c,[(0,r.bF)(x,{disabled:y.disableTooltip,content:"返回主管理页",placement:"bottom"},{default:(0,r.k6)((()=>[(0,r.bF)(z,{icon:"home",class:"header-icon",onClick:y.handleGoHome},null,8,["onClick"])])),_:1},8,["disabled"]),(0,r.bF)(x,{disabled:y.disableTooltip,content:"返回上传页",placement:"bottom"},{default:(0,r.k6)((()=>[(0,r.bF)(z,{icon:"upload",class:"header-icon",onClick:y.handleGoUpload},null,8,["onClick"])])),_:1},8,["disabled"]),(0,r.bF)(x,{disabled:y.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,r.k6)((()=>[(0,r.bF)(z,{icon:"sign-out-alt",class:"header-icon",onClick:y.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,r.Lk)("div",g,[(0,r.bF)(F,{data:C.dealedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed",onExpandChange:y.expandRow},{default:(0,r.k6)((()=>[(0,r.bF)(S,{type:"expand"},{default:(0,r.k6)((e=>[(0,r.Lk)("div",m,[a[1]||(a[1]=(0,r.Lk)("h3",{style:{"text-align":"center"}},"上传文件列表",-1)),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(F,{"expand-row-keys":C.expandRowKeys,"row-key":y.getRowKeys,data:e.row.data,style:{width:"100%"},"default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed"},{default:(0,r.k6)((()=>[(0,r.bF)(S,{prop:"metadata.FileName",label:"文件名"}),(0,r.bF)(S,{prop:"name",label:"文件预览"},{default:(0,r.k6)((({row:e})=>[e.metadata?.FileType?.includes("image")?((0,r.uX)(),(0,r.Wv)(v,{key:0,src:"/file/"+e.name,fit:"cover",lazy:"",style:{width:"100px",height:"100px"}},null,8,["src"])):((0,r.uX)(),(0,r.CE)("video",{key:1,src:"/file/"+e.name,controls:"",style:{width:"100px",height:"100px"}},null,8,b))])),_:1}),(0,r.bF)(S,{formatter:y.formatTimeStamp,label:"上传时间",prop:"metadata.TimeStamp",sortable:"","sort-method":y.sortByTimestamp},{default:(0,r.k6)((({row:e})=>[(0,r.eW)((0,h.v_)(y.formatTimeStamp(e.metadata.TimeStamp)),1)])),_:1},8,["formatter","sort-method"])])),_:2},1032,["expand-row-keys","row-key","data"])),[[T,C.loading]]),(0,r.Lk)("div",f,[(0,r.bF)(P,{background:"",layout:"total, sizes, prev, pager, next","page-sizes":[15,100,300,500,1e3,5e3,1e4],total:e.row.total,"page-size":e.row.pageSize,onSizeChange:a=>y.handlePageSizeChange(a,e.row),disabled:e.row.disabledPage,onCurrentChange:a=>y.handlePageChange(a,e.row),"current-page":e.row.page},null,8,["total","page-size","onSizeChange","disabled","onCurrentChange","current-page"])])])])),_:1}),(0,r.bF)(S,{prop:"ip",label:"IP地址"}),(0,r.bF)(S,{prop:"count",label:"上传次数",sortable:""})])),_:1},8,["data","onExpandChange"])]),(0,r.Lk)("div",w,[(0,r.bF)(P,{background:"",layout:"total, sizes, prev, pager, next","page-sizes":[15,100,300,500,1e3,5e3,1e4],total:C.tableData.total,"page-size":C.tableData.pageSize,onSizeChange:y.handlePageSizeChange2,disabled:C.tableData.disabledPage,onCurrentChange:y.handlePageChange2,"current-page":C.tableData.page},null,8,["total","page-size","onSizeChange","disabled","onCurrentChange","current-page"])])])}t(4114);var C=t(782),y={name:"CustomerConfig",data(){return{loading:!1,tableData:{total:0,page:1,pageSize:15,disabledPage:!1},dealedData:[],expandRowKeys:[]}},computed:{...(0,C.L8)(["credentials"]),disableTooltip(){return window.innerWidth<768}},methods:{handlePageChange(e,a){a.page=e,this.getList(a)},handlePageSizeChange(e,a){a.pageSize=e,this.getList(a)},handlePageChange2(e){this.tableData.page=e,this.getIpGroupList(row)},handlePageSizeChange2(e){this.tableData.pageSize=e,this.getIpGroupList()},getIpGroupList(){const e=this.tableData;let a="https://studyjava.cn/api/cloudflare/files/ip",t=[];Object.keys(e).forEach((a=>{e[a]&&t.push(a+"="+e[a])})),-1===a.search(/\?/)?a+="?"+t.join("&"):a+="&"+t.join("&"),fetch(a,{method:"GET"}).then((e=>e.json())).then((e=>{this.tableData=[],this.dealedData=this.dealByIP(e.data)})).catch((e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接"+e.message)}))},getList(e){e.expand||(e.disabledPage=!0,this.fetchWithAuth("/api/manage/list?ip="+e.ip+"&page="+e.page+"&pageSize="+e.pageSize,{method:"GET"}).then((e=>e.json())).then((a=>{e.data=a.data,e.expand=!0,e.disabledPage=!1,this.loading=!1})).catch((e=>{this.loading=!1,"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")})))},getRowKeys:function(e){return e.id},expandRow(e,a){this.loading=!0,a.length?(this.expandRowKeys=[],e&&(this.expandRowKeys.push(e.id),this.getList(e))):this.expandRowKeys=[]},async fetchWithAuth(e,a={}){this.credentials&&(a.headers={...a.headers,Authorization:`Basic ${this.credentials}`},a.credentials="include");const t=await fetch(e,a);if(401===t.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return t},dealByIP(e){let a=[];return this.tableData.total=e.total,e.records.forEach((e=>{let t=e?.UploadIP,n=e?.count;a.push({id:t,ip:t,count:n,total:n,page:1,pageSize:15,disabledPage:!1,data:[]})})),a},handleGoUpload(){this.$router.push("/")},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},handleGoHome(){this.$router.push("/dashboard")},formatTimeStamp(e){return new Date(e).toLocaleString()},sortByTimestamp(e,a){return new Date(e.metadata.TimeStamp)-new Date(a.metadata.TimeStamp)}},mounted(){this.fetchWithAuth("/api/manage/check",{method:"GET"}).then((e=>e.text())).then((e=>{if("true"==e)this.showLogoutButton=!0,this.getIpGroupList();else{if("Not using basic auth."!=e)throw new Error("Unauthorized");this.getIpGroupList()}})).catch((e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接"+e.message)}))}},z=t(1241);const x=(0,z.A)(y,[["render",k],["__scopeId","data-v-7d7411f8"]]);var L=x},8736:function(e,a,t){t(5331)},7128:function(e,a,t){t(5331),t(4318)},8450:function(e,a,t){t(5331)},694:function(e,a,t){t(5331)},5534:function(e,a,t){t(5331),t(8785),t(5970),t(9104)},9104:function(e,a,t){t(5331)},5970:function(e,a,t){t(5331)},8785:function(e,a,t){t(5331)},213:function(e,a,t){t(5331),t(9104)}}]);
//# sourceMappingURL=747.aa5861fb.js.map